<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ÙØªØ± Ø§Ù„Ø¯ÙŠÙˆÙ† | Ø§Ù„Ø³ÙŠØ§Ø±ÙŠ</title>
    <style>
        :root { --gold: #d4af37; --dark: #121212; --red: #e74c3c; --green: #27ae60; --blue: #3498db; }
        body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 70px 15px; direction: rtl; }
        .header { background: var(--dark); color: var(--gold); padding: 15px; position: fixed; top: 0; left: 0; width: 100%; text-align: center; font-weight: bold; z-index: 100; border-bottom: 2px solid var(--gold); }
        .debt-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 12px; border-right: 6px solid var(--red); }
        .debt-info b { font-size: 1.2rem; color: var(--dark); }
        .amount { color: var(--red); font-weight: bold; font-size: 1.3rem; float: left; }
        .actions { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }
        .btn { flex: 1; min-width: 100px; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.85rem; transition: 0.2s; }
        .btn-pay { background: var(--green); color: white; }
        .btn-remind { background: var(--dark); color: var(--gold); border: 1px solid var(--gold); }
        .phone-tag { color: var(--blue); font-size: 0.85rem; display: block; margin-top: 4px; }
        
        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        .opt-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .opt-content { background: white; padding: 20px; border-radius: 15px; width: 85%; max-width: 350px; text-align: center; }
        .opt-btn { width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1rem; }
    </style>
</head>
<body>

<div class="header">ğŸ““ Ø¯ÙØªØ± Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©</div>

<div id="debtsList">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†...</div>

<div id="contactModal" class="opt-modal">
    <div class="opt-content">
        <h3 id="optTitle" style="margin-top:0;">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
        <button class="opt-btn" style="background:#25D366; color:white;" id="waBtn">ğŸŸ¢ ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="opt-btn" style="background:#3498db; color:white;" id="callBtn">ğŸ”µ Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±</button>
        <button class="opt-btn" style="background:#f39c12; color:white;" id="smsBtn">ğŸŸ¡ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ© SMS</button>
        <button onclick="document.getElementById('contactModal').style.display='none'" style="background:none; border:none; color:#777; margin-top:10px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot, updateDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    const firebaseConfig = {  
        apiKey: "AIzaSyAD5GAic-ioZhetXQQ4u8shXScxTZO2DoI",
        authDomain: "elite-store-8f693.firebaseapp.com",
        projectId: "elite-store-8f693",
        storageBucket: "elite-store-8f693.firebasestorage.app",
        messagingSenderId: "227353365436",
        appId: "1:227353365436:web:e662600dac0e83fe6739b9",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    onSnapshot(collection(db, "debts"), (snap) => {
        const list = document.getElementById('debtsList');
        list.innerHTML = snap.empty ? "<p style='text-align:center;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.. Ø§Ù„ÙƒÙ„ Ù…Ø³Ø¯Ø¯!</p>" : "";
        
        snap.forEach(docBox => {
            const d = docBox.data();
            const id = docBox.id;
            const phone = d.phone || "Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…";
            
            list.innerHTML += `
                <div class="debt-card">
                    <span class="amount">${d.amount}$</span>
                    <div class="debt-info">
                        <b>ğŸ‘¤ ${d.customer}</b>
                        <span class="phone-tag">ğŸ“ ${phone}</span>
                        <small>ğŸ“… Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ©: ${d.date?.toDate().toLocaleDateString('ar-SA')}</small>
                    </div>
                    <div class="actions">
                        <button class="btn btn-pay" onclick="payDebt('${id}', ${d.amount})">ğŸ’° ØªØ³Ø¯ÙŠØ¯ Ø¬Ø²Ø¡</button>
                        <button class="btn btn-remind" onclick="window.openContactMenu('${d.customer}', '${phone}', ${d.amount})">ğŸ”” ØªØ°ÙƒÙŠØ± / Ø§ØªØµØ§Ù„</button>
                    </div>
                </div>`;
        });
    });

    window.payDebt = async (id, currentAmount) => {
        const pay = prompt(`ÙƒÙ… Ø¯ÙØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø£ØµÙ„ ${currentAmount}$ ØŸ`);
        if (pay && !isNaN(pay)) {
            const newAmount = currentAmount - parseFloat(pay);
            const ref = doc(db, "debts", id);
            if (newAmount <= 0) {
                await deleteDoc(ref);
                alert("ØªÙ… ØªØµÙÙŠØ© Ø§Ù„Ø¯ÙŠÙ†! Ø±Ø§Ø¹ÙŠÙ†Ø§Ù‡Ù… ÙˆØ¨ÙŠØ¶ÙˆØ§ Ø§Ù„ÙˆØ¬ÙŠÙ‡ âœ…");
            } else {
                await updateDoc(ref, { amount: newAmount, date: new Date() });
            }
        }
    };

    window.openContactMenu = (name, phone, amount) => {
        if (!phone || phone === "Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…" || phone === "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…") return alert("Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‡Ø°Ø§ Ù…Ø¬Ù‡ÙˆÙ„ Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ Ù…Ø§ Ù„Ù‡ Ø±Ù‚Ù…!");

        document.getElementById('optTitle').innerText = `ØªØ°ÙƒÙŠØ±: ${name}`;
        const modal = document.getElementById('contactModal');
        modal.style.display = 'flex';

        const msg = encodeURIComponent(`Ø¹Ø²ÙŠØ²ÙŠ ${name}ØŒ Ù†Ø°ÙƒØ±ÙƒÙ… Ø¨Ø£Ù† Ø¹Ù„ÙŠÙƒÙ… Ø¯ÙŠÙ† Ù…ØªØ¨Ù‚ÙŠ Ø¨Ù…Ø¨Ù„Øº (${amount}$) Ù„Ø¯Ù‰ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø³ÙŠØ§Ø±ÙŠ âšœï¸. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ø¯Ø§Ø¯ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª.`);

        document.getElementById('waBtn').onclick = () => window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
        document.getElementById('callBtn').onclick = () => window.location.href = `tel:${phone}`;
        document.getElementById('smsBtn').onclick = () => window.location.href = `sms:${phone}?body=${msg}`;
    };
</script>
</body>
</html>
